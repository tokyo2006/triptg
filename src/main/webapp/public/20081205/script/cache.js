function Store(){return this._initialize.apply(this,arguments);}Store.prototype=(function(){var _list=null;var methods={flash:{_inited:false,size:100*1024,test:function(){if(!BB.Browser.ie){return false;}var f="-1";if(window.ActiveXObject){for(var i=10;i>=2;i--){try{var fl=eval("new ActiveXObject('ShockwaveFlash.ShockwaveFlash."+i+"');");if(fl){f=i;break;}}catch(ex){}}}return parseInt(f)>=8?true:false;},init:function(){var me=this;var timer=window.setInterval(function(){try{document.body.doScroll("left");var div=document.createElement("div");div.id="__FLASH_STORE_DIV__";document.body.appendChild(div);clearInterval(timer);var path=BB.JSPATH+"util/cache/";$("__FLASH_STORE_DIV__").innerHTML='<object id="__FLASH_STORE__" classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" codebase="http://fpdownload.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=8,0,0,0" width="1" height="1"><param name="allowScriptAccess" value="always" /><param name="movie" value="'+path+"cache.swf?v="+Math.random()+'" /><param name="autostart" value="true" />';me._inited=true;}catch(ex){}},10);},get:function(key,fn){var me=this;var intVal=setInterval(function(){if(me._inited&&$("__FLASH_STORE__")&&$("__FLASH_STORE__").get){var ret="";try{ret=$("__FLASH_STORE__").get("__STORE__",key);}catch(ex){}clearInterval(intVal);intVal=null;if(fn){fn.call(me,ret||"");}}},10);setTimeout(function(){if(intVal){clearInterval(intVal);if(fn){fn.call(me,"");}}},1000);},set:function(key,value){if(value==""){return ;}var me=this;var intVal=setInterval(function(){if(me._inited&&$("__FLASH_STORE__")&&$("__FLASH_STORE__").set){try{$("__FLASH_STORE__").set("__STORE__",key,value);}catch(ex){}clearInterval(intVal);intVal=null;}},10);setTimeout(function(){if(intVal){clearInterval(intVal);}},1000);},remove:function(key){var me=this;var intVal=setInterval(function(){if(me._inited&&$("__FLASH_STORE__")&&$("__FLASH_STORE__").remove){try{$("__FLASH_STORE__").remove("__STORE__",key);}catch(ex){}clearInterval(intVal);intVal=null;}},10);setTimeout(function(){if(intVal){clearInterval(intVal);}},1000);}},whatwg_db:{_inited:false,_db:null,size:200*1024,test:function(){try{if(window.openDatabase){this._db=openDatabase("_BB_","1.0","database",this.size);return !!this._db;}else{return false;}}catch(err){return false;}},init:function(){if(!this._inited){this._db.transaction(function(t){t.executeSql("CREATE TABLE _BB_ (k TEXT UNIQUE NOT NULL PRIMARY KEY, v TEXT NOT NULL)",[],function(){});},function(){});this._inited=true;}},get:function(key,fn){var ret="";this._db.transaction(function(t){t.executeSql("SELECT v FROM _BB_ Where k=?",[key],function(t,r){if(r.rows.length>0){ret=r.rows.item(0)["v"];if(fn){fn.call(this,ret===null?"":ret);}}else{if(fn){fn.call(this,"");}}},function(){if(fn){fn.call(this,ret===null?"":ret);}});});},set:function(key,value){this.remove(key);this._db.transaction(function(t){t.executeSql("INSERT INTO _BB_ (k,v) VALUES (?, ?)",[key,value],function(){});},function(){});},remove:function(key){this._db.transaction(function(t){t.executeSql("DELETE FROM _BB_ WHERE k=?",[key],function(){});},function(){});}},globalstorage:{size:5*1024*1024,test:function(){return !!window.globalStorage&&BB.Browser.firefox&&BB.Browser.version>=2;},init:function(){},get:function(key,fn){var ret=globalStorage[location.hostname].getItem(key);ret=ret===null?"":ret;if(fn){fn.call(this,ret);}return ret;},set:function(key,value){globalStorage[location.hostname].setItem(key,value);},remove:function(key){globalStorage[location.hostname].removeItem(key);}},userdata:{_inited:false,size:64*1024,test:function(){if(!!window.ActiveXObject){try{document.documentElement.addBehavior("#default#userdata");this._inited=true;return true;}catch(e){return false;}}else{return false;}},init:function(){},get:function(key,fn){document.documentElement.load(key);var ret=document.documentElement.getAttribute("value")||"";ret=ret===null?"":ret;if(fn){fn.call(this,ret);}return ret;},set:function(key,value){document.documentElement.load(key);document.documentElement.setAttribute("value",value);document.documentElement.save(key);},remove:function(key){this.set(key,"");}},cookie:{size:4000,test:function(){var k="__EC_TEST__",v=new Date().toGMTString();this.set(k,v);var r=this.get(k);this.remove(k);return r==v;},init:function(){},get:function(key,fn){var search=key+"=";var ret="";if(document.cookie.length>0){var offset=document.cookie.indexOf(search);if(offset!=-1){offset+=search.length;var end=document.cookie.indexOf(";",offset);if(end==-1){end=document.cookie.length;}ret=unescape(document.cookie.substring(offset,end));}}ret=ret===null?"":ret;if(fn){fn.call(this,ret);}return ret;},set:function(key,value,expires){var expires=expires||1000*60*60*24*365;var now=new Date();now.setTime(new Date().getTime()+expires);document.cookie=key+"="+escape(value)+"; path=/; expires="+now.toGMTString();},remove:function(key){this.set(key,"",-1000*60*60*24*365);}}};return{_initialize:function(){_list=arguments.length>0?Array.toArray(arguments):["globalstorage","userdata","whatwg_db","cookie"];for(var i=0;i<_list.length;i++){var method=methods[_list[i]];if(method.test()){method.storageType=_list[i];method.init();return method;}}return null;}};})();var Cookie=new Store("cookie");var Storage=new Store();