document.domain="baidu.com";window.cangDomainWin=null;function loadCangBaiduDomain(){window.cangDomainWin=window.frames.CangBaiduDomain;}function ajax4Firefox2Bug(E,D,A,C){if(!E.getAnOpenRequest){var F=E.document.createElement("script");var B="function getAnOpenRequest(method,url,async){var req=new XMLHttpRequest();req.open(method,url,async);return req;};";F.innerHTML=B;E.document.body.appendChild(F);}return E.getAnOpenRequest(D,A,C);}String.prototype._decode4Baidu=function(){var C=[/</g,/"/g,/'/g,/&nbsp/g];var D=["&lt;","&quot;","&#039;","&amp;nbsp"];var B=this;for(var A=0;A<C.length;A++){B=B.replace(C[A],D[A]);}return B.decode4Html();};var cangBaseTag="C2C商品";var cangItemUrl=c2cServerUrl+"item/";var cangItemTitle="";var cangDialogTitle="收藏商品";document.DOMLoaded(function(){var A=Dom.getElementsByClassName("add_favo_link");for(var B=0;B<A.length;B++){A[B].onclick=openCangDialog;}});function openCangDialog(G,E){E=E||window.cangAddHdl||this;window.cangAddHdl=E;if(!User.isLoginBaidu()){try{User.Login.show(openCangDialog,true);return false;}catch(G){}}try{BBEvent.preventDefault(G);}catch(G){}var F=(E.getAttribute("favo_type")+"").toLowerCase();if(F=="item"){cangBaseTag="C2C商品";cangItemUrl=(c2cServerUrl+"item/")+(E.getAttribute("favo_obj_id"));cangItemTitle=E.getAttribute("favo_title");cangDialogTitle="收藏商品";}else{if(F=="shop"){cangBaseTag="C2C店铺";cangItemUrl=(c2cServerUrl+"shop/")+(E.getAttribute("favo_obj_id"));cangItemTitle=E.getAttribute("favo_title");cangDialogTitle="收藏店铺";}else{return false;}}var C=window.CangAddDialog;if(C){C.hide();window.itemAddData=null;C.dispose();}if(true){C=window.CangAddDialog=new Dialog({center:false});C.setCaption(cangDialogTitle);var D='<div class="panel-cangadd-dialog" id="panel-cangadd-page">	<ul>		<li>			<label class="k" >分类：</label>			<span class="v"><span><input type="text" size="47" id="cangTag" name="cangTag" dataType="uv" onblur="return chkCangItemTag(this);"></span><a href="#1" class="cat-link-default" onclick="toggleDisplayTags(this);return false;" id="tagsCtnHdl">选择分类</a><em>可以添加多个分类，以“，”“；”“、”隔开</em></span>		</li>		<li>			<label class="k" >描述：</label>			<span class="v"><textarea id="cangComments" name="cangComments"  dataType="uv" onblur="return chkCangItemComment(this);"></textarea></span><br/><em></em>		</li>		<li>			<label class="k">&nbsp;</label>			<span class="v"><input type="checkbox" name="cangPrivate" id="cangPrivate">	<label for="cangPrivate">设为私有</label></span>		</li>		<li class="submit">			<label class="k">&nbsp;</label>			<span class="v"><button onclick="cangAddOk();">添加收藏</button><button onclick="cangAddCancel();">取消</button></span>		</li>	</ul>	<div id="tagsCtn" class="cat-content" style="display:none;" >		<div style="display:none"><h3>推荐分类</h3><p id="recmdTags">&nbsp;</p></div>		<div style="display:none"><h3>我的分类</h3><p id="myTags">&nbsp;</p></div>		<div>&nbsp;</div>	</div></div><div class="panel-temp-0807013879" id="panel-cangadd-ok" style="display:none;">	<p class="s1"><span class="ok">收藏成功</span><br><br><a href="/user/0/cang/0/'+F+'" target="_blank">查看我的收藏</a></p>	<p class="s2">本窗口将在2秒内自动关闭...<br><button type=button onclick="window.CangAddDialog.hide();">立即关闭</button></p></div>';C.setContent(D);if(!window.Cookie){var B=document.createElement("script");B.src=BB.JSPATH+"/util/cache/cache.js";document.getElementsByTagName("head")[0].appendChild(B);}var B=document.createElement("script");B.src=cangServerUrl+"do/add?o=json&fr=c2c&iu="+encodeURIComponent(cangItemUrl);document.getElementsByTagName("head")[0].appendChild(B);var A=window.setInterval(function(){if(window.itemAddData){window.clearInterval(A);fillTagsCtn();}},10);}C.show(0,E.offsetHeight,$("tagsCtn").style.display=="none"?470:670,null,E);if(!$("CangBaiduDomain")){Dom.insertAdjacentHTML(document.body,"afterBegin",'<iframe name="CangBaiduDomain" id="CangBaiduDomain" src="'+cangServerUrl+'BaiduDomain.htm" onload="loadCangBaiduDomain();" style="display:none;"></iframe>');}}function fillTagsCtn(){if(!itemAddData.userLogin){User.Login.show(openCangDialog,true);window.itemAddData=null;return false;}if(window.Cookie&&Cookie.get("YOUA_Cang_ST")==1&&$("tagsCtn").style.display=="none"){toggleDisplayTags($("tagsCtnHdl"));}var G=itemAddData.recmdTags;var F=[],E=[];if(G){var A=G.split(",");for(var D=0;D<A.length;D++){var C=A[D].replace(cangBaseTag,"").replace(/^\./,"").trim();if(C){F.push('<a href="#" onclick="selectTag(\''+C.encode4Js()+"');return false;\" >"+C._decode4Baidu().encode4Html()+"</a>");}}}if(F.length){$("recmdTags").innerHTML=F.join("， ");$("recmdTags").parentNode.style.display="";}else{$("recmdTags").parentNode.style.display="none";}var B=itemAddData.itemTags;if(B){var A=B.split(",");for(var D=0;D<A.length;D++){var C=A[D].replace(cangBaseTag,"").replace(/^\./,"").trim();if(A[D].indexOf(cangBaseTag+".")==0){E.push('<a href="#" onclick="selectTag(\''+C.encode4Js()+"');return false;\" >"+C._decode4Baidu().encode4Html()+"</a>");}}}if(E.length){$("myTags").innerHTML=E.join("， ");$("myTags").parentNode.style.display="";}else{if(F.length){$("myTags").parentNode.style.display="none";}else{$("myTags").innerHTML="您目前没有分类";}}}function toggleDisplayTags(C){var B=window.CangAddDialog;var A=$("tagsCtn");if(A.style.display=="none"){C.className="cat-link-open";C.innerHTML="隐藏分类";A.style.display="block";B.setDialogRect(null,null,670,null);B.adjustPosition();B.setMaskFullscreen();if(window.Cookie){Cookie.set("YOUA_Cang_ST","1");}}else{window.CangAddDialog.setDialogRect(null,null,470,null);C.className="cat-link-default";C.innerHTML="选择分类";A.style.display="none";if(window.Cookie){Cookie.set("YOUA_Cang_ST","0");}}}function selectTag(E){var D=$("cangTag");var B=D.value.trim().split(/[,;，；、]/g);var F=[];var H=false;for(var C=0;C<B.length;C++){var A=B[C].trim();if(!A){continue;}if(A==E){H=true;}else{if(!F.contains(A)){F.push(A);}}}if(!H){F.push(E);}F.push("");try{D.focus();}catch(G){}D.value=F.join(",");window.setTimeout(function(){D.focus();},300);}function chkCangItemTag(E){E=E||this;var B=E.value.trim().split(/[,;，；、]/g);var F=[];for(var C=0;C<B.length;C++){var A=B[C].trim();if(A&&!F.contains(A)){F.push(A);}}F.push("");E.value=F.join(",");if(!BBValid.chkMandatoryIfOk(null,E)){return false;}var B=E.value.split(/[,;，；、]/g);var G=[cangBaseTag];for(var C=0;C<B.length;C++){var D=B[C].trim();if(D.byteLen()>12){BBValid.vldErrorFun(E,"单个分类名称不能超过6个汉字或12个字母。");return false;}if(D){G.push(cangBaseTag+"."+D);}}if(G.length>5){BBValid.vldErrorFun(E,"最多只能有四个分类");return false;}return BBValid.vldOkFun(E);}function chkCangItemComment(A){A=A||this;if(!BBValid.chkMandatoryIfOk(null,A)){return false;}if(A.value.byteLen()>240){BBValid.vldErrorFun(A,"描述不能超过120个汉字或240个字母。");return false;}return BBValid.vldOkFun(A);}function cangAddOk(){var frm={elements:[$("cangTag"),$("cangComments")]};if(!BBValid.chkAllEls(frm)){return false;}var tags=$("cangTag").value.split(/[,;，；、]/g);var sTags=[cangBaseTag];for(var i=0;i<tags.length;i++){var s=tags[i].trim();if(s){sTags.push(cangBaseTag+"."+s);}}var sData="ct=5&it="+encodeURIComponent(cangItemTitle)+"&iu="+encodeURIComponent(cangItemUrl)+"&st="+($("cangPrivate").checked?0:1)+"&tn="+(encodeURIComponent(sTags.join("，")))+"&dc="+encodeURIComponent($("cangComments").value);try{var req=cangDomainWin.getNewXMLHttpRequest();try{req.open("post","do/cm",false);}catch(ex){req=ajax4Firefox2Bug(cangDomainWin,"post","do/cm",false);}req.setRequestHeader("Content-Type","application/x-www-form-urlencoded");req.send(sData);var result=eval("("+req.responseText+")");if(result.userLogin=="0"){User.Login.show();return false;}if(result.resultBool){$("panel-cangadd-page").style.display="none";$("panel-cangadd-ok").style.display="";window.setTimeout(function(){window.CangAddDialog.hide();},2000);return true;}else{if(result.resultNum=="30005"){if(confirm("已收藏该URL，是否要覆盖原有收藏？")){sData="ct=8&iid="+result.itemId+sData.substr(4);return forceAddCang(sData);}else{window.CangAddDialog.hide();return false;}}alert("添加收藏失败："+result.resultNo);return false;}}catch(e){alert("添加收藏失败。");return false;}}function forceAddCang(sData){try{var req=cangDomainWin.getNewXMLHttpRequest();try{req.open("post","do/cm",false);}catch(ex){req=ajax4Firefox2Bug(cangDomainWin,"post","do/cm",false);}req.setRequestHeader("Content-Type","application/x-www-form-urlencoded");req.send(sData);var result=eval("("+req.responseText+")");if(result.userLogin=="0"){User.Login.show();return false;}if(result.resultBool){$("panel-cangadd-page").style.display="none";$("panel-cangadd-ok").style.display="";window.setTimeout(function(){window.CangAddDialog.hide();},2000);return true;}else{alert("添加收藏失败："+result.resultNo);return false;}}catch(e){alert("添加收藏失败。");return false;}}function cangAddCancel(){window.CangAddDialog.hide();}